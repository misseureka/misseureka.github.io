<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>   
</head>
<body>
	<h1>
        <a href="/click1.html">Click me!</a>    
        <a href="https://misseureka.github.io/click2.html">No, click me! I'm better!</a>   
    </h1>
</body>

<script>
	(function() {     
        var REDIRECT_URL = 'https://hz-test1.rutarget.ru/redirect',
        	COOKIE_DEF_NAME = 'rutarget_cookie',
        	COOKIE_DEF_VALUE = 1,
        	COOKIE_DEF_EXP = 365;        

        var getParent = function(el, parent){
        	return parent === el.nodeName.toLowerCase() ? el : el.parentElement ? getParent(el.parentElement, parent) : null;
        }

        var cookie = {
        	set: function(name, value, days){
        		var expires = ''
        		if (days){
	        		var date  = new Date;
	                date.setDate(date.getDate() + days);
	                expires = '; expires=' + date.toUTCString();
	            }
	            document.cookie = name + '=' + value + expires + '; path=/;';
        	},
        	get: function(name){
        		var cookie = '; ' + document.cookie;
				var parts = cookie.split('; ' + name + '=');
				return parts.length == 2 ? parts.pop().split(';').shift() : null;
        	}
        }

        var redirect = {
        	getLink: function(link){
                return REDIRECT_URL + '?url=' + link;
        	},
        	clickListener: function(e){
        		if (!cookie.get(COOKIE_DEF_NAME) && !e.defaultPrevented) {
                    var link = getParent(e.target, 'a');
                    if (link && link.host && link.href) {
                    	cookie.set(COOKIE_DEF_NAME, COOKIE_DEF_VALUE, COOKIE_DEF_EXP);
                    	var h = link.href;
                    	link.href = redirect.getLink(h); 
                    	setTimeout(function() {                    		
                    		link.href = h;
                    	}, 0);

                    }
                }
        	}
        }

        var isSafariBrowser = function(){
        	var ua = navigator.userAgent.toLowerCase(); 
        	return ua.indexOf('safari') != -1 && ua.indexOf('chrome') == -1;
        }

        var init = function(){        	
			if (isSafariBrowser() && !cookie.get(COOKIE_DEF_NAME)){
            	window.top.addEventListener('click', redirect.clickListener, false);   
			}
        }

        init();

	})();
</script>
</html>